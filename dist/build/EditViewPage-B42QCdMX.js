import{r as z,ca as G,u as k,a as q,bq as H,bX as Q,dx as Y,dy as U,j as t,bo as r,ce as X,dz as _,bw as $,dA as J,dB as d,b$ as f,by as b,dC as K,dD as W,dE as v,cO as Z,bt as tt,dF as st,dG as et,k as at,dH as it}from"./strapi-B8XjzIdc.js";import{u as nt,F as C}from"./Input-JBCQxwlp.js";import"./usePrev-B16Rb3Bk.js";import"./objects-Djr7ghJW.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-CCmJYiMg.js";const ot=s=>z.useEffect(s,rt),rt=[],dt=()=>{const s=G(),[{query:{status:a}},i]=k({status:"draft"}),{formatMessage:n}=q(),{toggleNotification:o}=H(),c=Q(),{document:x,meta:u,isLoading:I,schema:l,components:j,collectionType:y,id:L,model:S,hasError:A,getTitle:P,getInitialFormValues:R}=c,m=l?.options?.draftAndPublish??!1;ot(()=>{s?.state&&"error"in s.state&&o({type:"danger",message:s.state.error,timeout:5e3})});const F=Y("EditViewPage",e=>e.isLoading),g=!L&&!(y===it),{isLoading:V,edit:{layout:E,settings:{mainField:T}}}=U(S),{isLazyLoading:B}=nt([]),M=F||I||V||B,h=R(g);if(M&&!x?.documentId)return t.jsx(r.Loading,{});if(!h||A)return t.jsx(r.Error,{});const w=e=>{(e==="published"||e==="draft")&&i({status:e},"push",!0)},N=(e,p)=>v(l?.attributes,j,{status:a,...p}).validateSync(e,{abortEarly:!1});return t.jsxs(X,{paddingLeft:10,paddingRight:10,children:[t.jsx(r.Title,{children:P(T)}),t.jsx(_,{initialDocument:{documentId:L,model:S,collectionType:y},children:t.jsx($,{disabled:m&&a==="published",initialValues:h,method:g?"POST":"PUT",validate:(e,p)=>v(l?.attributes,j,{status:a,...p}).validate(e,{abortEarly:!1}),initialErrors:s?.state?.forceValidation?N(h,{}):{},children:({resetForm:e})=>t.jsxs(t.Fragment,{children:[t.jsx(J,{isCreating:g,status:m?ct(x,u):void 0,title:P(T)}),t.jsxs(d.Root,{variant:"simple",value:a,onValueChange:w,children:[t.jsx(d.List,{"aria-label":n({id:f("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:m?t.jsxs(t.Fragment,{children:[t.jsx(D,{value:"draft",children:n({id:f("containers.edit.tabs.draft"),defaultMessage:"draft"})}),t.jsx(D,{disabled:!u||u.availableStatus.length===0,value:"published",children:n({id:f("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),t.jsxs(b.Root,{paddingTop:8,gap:4,children:[t.jsxs(b.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[t.jsx(d.Content,{value:"draft",children:t.jsx(C,{layout:E,document:c})}),t.jsx(d.Content,{value:"published",children:t.jsx(C,{layout:E,document:c})})]}),t.jsx(b.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:t.jsx(K,{})})]})]}),t.jsx(W,{onProceed:e})]})})})]})},D=at(d.Trigger)`
  text-transform: uppercase;
`,ct=(s,a)=>{const i=s?.status,n=a?.availableStatus??[];return i?i==="draft"&&n.find(o=>o.publishedAt!==null)?"published":i:"draft"},bt=()=>{const{slug:s=""}=Z(),{permissions:a=[],isLoading:i,error:n}=tt(st.map(o=>({action:o,subject:s})));return i?t.jsx(r.Loading,{}):n||!s?t.jsx(r.Error,{}):t.jsx(r.Protect,{permissions:a,children:({permissions:o})=>t.jsx(et,{permissions:o,children:t.jsx(dt,{})})})};export{dt as EditViewPage,bt as ProtectedEditViewPage,ct as getDocumentStatus};
