import{a as B,j as e,bB as y,eg as le,cj as ce,ej as M,eA as ue,eB as pe,cT as be,cU as he,e as me,by as V,bx as X,cr as S,e5 as d,cs as i,cE as U,ct as n,e6 as ge,b as fe,r as w,bq as xe,e2 as ve,bp as je,cH as ye,bt as Pe,e7 as ae,e8 as qe,e9 as Me,bo as C,bv as F,d0 as Le,d1 as Re,d2 as K,d3 as z,T as L,d5 as Te,d6 as we,d7 as I,I as Ce,g as ke,cx as Ee}from"./strapi-B8XjzIdc.js";import{P as s}from"./index-sxgpSYXm.js";const $=({description:r,disabled:x,intlLabel:h,error:c,name:u,onChange:v,placeholder:t,providerToEditName:m,type:b,value:l})=>{const{formatMessage:o}=B(),g=u==="noName"?`${window.strapi.backendURL}/api/connect/${m}/callback`:l,j=o({id:h.id,defaultMessage:h.defaultMessage},{provider:m,...h.values}),p=r?o({id:r.id,defaultMessage:r.defaultMessage},{provider:m,...r.values}):"";if(b==="bool")return e.jsxs(y.Root,{hint:p,name:u,children:[e.jsx(y.Label,{children:j}),e.jsx(le,{"aria-label":u,checked:l,disabled:x,offLabel:o({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:o({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:q=>{v({target:{name:u,value:q.target.checked}})}}),e.jsx(y.Hint,{})]});const P=t?o({id:t.id,defaultMessage:t.defaultMessage},{...t.values}):"",k=c?o({id:c,defaultMessage:c}):"";return e.jsxs(y.Root,{error:k,name:u,children:[e.jsx(y.Label,{children:j}),e.jsx(ce,{disabled:x,onChange:v,placeholder:P,type:b,value:g}),e.jsx(y.Error,{})]})};$.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""};$.propTypes={description:s.shape({id:s.string.isRequired,defaultMessage:s.string.isRequired,values:s.object}),disabled:s.bool,error:s.string,intlLabel:s.shape({id:s.string.isRequired,defaultMessage:s.string.isRequired,values:s.object}).isRequired,name:s.string.isRequired,onChange:s.func.isRequired,placeholder:s.shape({id:s.string.isRequired,defaultMessage:s.string.isRequired,values:s.object}),providerToEditName:s.string.isRequired,type:s.string.isRequired,value:s.oneOfType([s.bool,s.string])};const D=({headerBreadcrumbs:r,initialData:x,isSubmiting:h,layout:c,isOpen:u,onSubmit:v,onToggle:t,providerToEditName:m})=>{const{formatMessage:b}=B();return e.jsx(M.Root,{open:u,onOpenChange:t,children:e.jsxs(M.Content,{children:[e.jsx(M.Header,{children:e.jsx(ue,{label:r.join(", "),children:r.map((l,o,g)=>e.jsx(pe,{isCurrent:o===g.length-1,children:l},l))})}),e.jsx(be,{onSubmit:l=>v(l),initialValues:x,validationSchema:c.schema,validateOnChange:!1,children:({errors:l,handleChange:o,values:g})=>e.jsxs(he,{children:[e.jsx(M.Body,{children:e.jsx(me,{direction:"column",alignItems:"stretch",gap:1,children:e.jsx(V.Root,{gap:5,children:c.form.map(j=>j.map(p=>e.jsx(V.Item,{col:p.size,xs:12,direction:"column",alignItems:"stretch",children:e.jsx($,{...p,error:l[p.name],onChange:o,value:g[p.name],providerToEditName:m})},p.name)))})})}),e.jsxs(M.Footer,{children:[e.jsx(X,{variant:"tertiary",onClick:t,type:"button",children:b({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),e.jsx(X,{type:"submit",loading:h,children:b({id:"global.save",defaultMessage:"Save"})})]})]})})]})})};D.defaultProps={initialData:null,providerToEditName:null};D.propTypes={headerBreadcrumbs:s.arrayOf(s.string).isRequired,initialData:s.object,layout:s.shape({form:s.arrayOf(s.array),schema:s.object}).isRequired,isOpen:s.bool.isRequired,isSubmiting:s.bool.isRequired,onSubmit:s.func.isRequired,onToggle:s.func.isRequired,providerToEditName:s.string};const Z={id:d("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},_={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},N={id:d("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},O={id:d("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},J={id:d("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},Y={id:d("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},R={id:d("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},ee={id:d("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},se=/^$|^[a-z][a-z0-9+.-]*:\/\/[^\s/$.?#](?:[^\s]*[^\s/$.?#])?$/i,Se=/^(([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+)(:\d+)?(\/\S*)?$/i,A={email:{form:[[{intlLabel:O,name:"enabled",type:"bool",description:N,size:6}]],schema:S().shape({enabled:U().required(n.required.id)})},providers:{form:[[{intlLabel:O,name:"enabled",type:"bool",description:N,size:6,validations:{required:!0}}],[{intlLabel:J,name:"key",type:"text",placeholder:R,size:12,validations:{required:!0}}],[{intlLabel:ee,name:"secret",type:"text",placeholder:R,size:12,validations:{required:!0}}],[{intlLabel:Z,placeholder:_,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:Y,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:S().shape({enabled:U().required(n.required.id),key:i().when("enabled",{is:!0,then:i().required(n.required.id),otherwise:i()}),secret:i().when("enabled",{is:!0,then:i().required(n.required.id),otherwise:i()}),callback:i().when("enabled",{is:!0,then:i().matches(se,n.regex.id).required(n.required.id),otherwise:i()})})},providersWithSubdomain:{form:[[{intlLabel:O,name:"enabled",type:"bool",description:N,size:6,validations:{required:!0}}],[{intlLabel:J,name:"key",type:"text",placeholder:R,size:12,validations:{required:!0}}],[{intlLabel:ee,name:"secret",type:"text",placeholder:R,size:12,validations:{required:!0}}],[{intlLabel:{id:d({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:R,size:12,validations:{required:!1}}],[{intlLabel:{id:d("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:d("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:Z,placeholder:_,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:Y,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:S().shape({enabled:U().required(n.required.id),key:i().when("enabled",{is:!0,then:i().required(n.required.id),otherwise:i()}),secret:i().when("enabled",{is:!0,then:i().required(n.required.id),otherwise:i()}),subdomain:i().when("enabled",{is:!0,then:i().matches(Se,n.regex.id).required(n.required.id),otherwise:i()}),callback:i().when("enabled",{is:!0,then:i().matches(se,n.regex.id).required(n.required.id),otherwise:i()})})}},Ue=()=>{const{formatMessage:r,locale:x}=B(),h=ge(),{trackUsage:c}=fe(),[u,v]=w.useState(!1),[t,m]=w.useState(null),{toggleNotification:b}=xe(),{get:l,put:o}=ve(),{formatAPIError:g}=je(),j=ye(x,{sensitivity:"base"}),{isLoading:p,allowedActions:{canUpdate:P}}=Pe({update:ae.updateProviders}),{isLoading:k,data:q}=qe(["users-permissions","get-providers"],async()=>{const{data:a}=await l("/users-permissions/providers");return a},{initialData:{}}),H=Me(a=>o("/users-permissions/providers",a),{async onSuccess(){await h.invalidateQueries(["users-permissions","get-providers"]),b({type:"success",message:r({id:d("notification.success.submit")})}),c("didEditAuthenticationProvider"),E()},onError(a){b({type:"danger",message:g(a)})},refetchActive:!1}),T=Object.entries(q).reduce((a,[f,de])=>{const{icon:Q,enabled:ne,subdomain:oe}=de;return a.push({name:f,icon:Q==="envelope"?["fas","envelope"]:["fab",Q],enabled:ne,subdomain:oe}),a},[]).sort((a,f)=>j.compare(a.name,f.name)),ie=k||p,W=w.useMemo(()=>t?!!T.find(f=>f.name===t)?.subdomain:!1,[T,t]),re=w.useMemo(()=>t==="email"?A.email:W?A.providersWithSubdomain:A.providers,[t,W]),E=()=>{v(a=>!a)},G=a=>{P&&(m(a.name),E())},te=async a=>{c("willEditAuthenticationProvider"),H.mutate({providers:{...q,[t]:a}})};return ie?e.jsx(C.Loading,{}):e.jsxs(F.Root,{children:[e.jsx(C.Title,{children:r({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:r({id:d("HeaderNav.link.providers"),defaultMessage:"Providers"})})}),e.jsxs(C.Main,{children:[e.jsx(F.Header,{title:r({id:d("HeaderNav.link.providers"),defaultMessage:"Providers"})}),e.jsx(F.Content,{children:e.jsxs(Le,{colCount:3,rowCount:T.length+1,children:[e.jsx(Re,{children:e.jsxs(K,{children:[e.jsx(z,{children:e.jsx(L,{variant:"sigma",textColor:"neutral600",children:r({id:"global.name",defaultMessage:"Name"})})}),e.jsx(z,{children:e.jsx(L,{variant:"sigma",textColor:"neutral600",children:r({id:d("Providers.status"),defaultMessage:"Status"})})}),e.jsx(z,{children:e.jsx(L,{variant:"sigma",children:e.jsx(Te,{children:r({id:"global.settings",defaultMessage:"Settings"})})})})]})}),e.jsx(we,{children:T.map(a=>e.jsxs(K,{onClick:()=>P?G(a):void 0,children:[e.jsx(I,{width:"45%",children:e.jsx(L,{fontWeight:"semiBold",textColor:"neutral800",children:a.name})}),e.jsx(I,{width:"65%",children:e.jsx(L,{textColor:a.enabled?"success600":"danger600","data-testid":`enable-${a.name}`,children:a.enabled?r({id:"global.enabled",defaultMessage:"Enabled"}):r({id:"global.disabled",defaultMessage:"Disabled"})})}),e.jsx(I,{onClick:f=>f.stopPropagation(),children:P&&e.jsx(Ce,{onClick:()=>G(a),variant:"ghost",label:"Edit",children:e.jsx(ke,{})})})]},a.name))})]})})]}),e.jsx(D,{initialData:q[t],isOpen:u,isSubmiting:H.isLoading,layout:re,headerBreadcrumbs:[r({id:d("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),Ee(t)],onToggle:E,onSubmit:te,providerToEditName:t})]})},Ie=()=>e.jsx(C.Protect,{permissions:ae.readProviders,children:e.jsx(Ue,{})});export{Ue as ProvidersPage,Ie as default};
